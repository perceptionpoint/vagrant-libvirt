<network ipv6='<%= @guest_ipv6 %>'>
  <name><%= @network_name %></name>
  <bridge name="<%= @network_bridge_name %>" />

  <% if (@network_forward_mode != 'none' && @network_forward_mode != 'veryisolated') %>
    <% if @network_forward_device %>
      <forward mode="<%= @network_forward_mode %>" dev="<%= @network_forward_device %>" />
    <% else %>
      <forward mode="<%= @network_forward_mode %>" />
    <% end %>
  <% end %>

  <% if @network_forward_mode != 'veryisolated' %>
    <ip address="<%= @network_address %>" netmask="<%= @network_netmask %>">
    <% if @network_dhcp_enabled  %>
      <dhcp>
        <range start="<%= @network_range_start %>" end="<%= @network_range_stop %>" />
        <% for @worker in (1 .. 80) %>
          <% for @box_idx in (10 .. 250).step(10) %>
            <host mac="c8:5b:76:20:<%= @worker.to_s(16).rjust(2, '0') %>:<%= @box_idx.to_s(16).rjust(2, '0') %>" ip="192.168.<%= @worker %>.<%= @box_idx %>"/>
          <% end %>
        <% end %>
        <% if @network_dhcp_bootp_file  %>
          <% if @network_dhcp_bootp_server  %>
            <bootp file="<%= @network_dhcp_bootp_file %>" server="<%= @network_dhcp_bootp_server %>" />
          <% else %>
            <bootp file="<%= @network_dhcp_bootp_file %>" />
          <% end %>
        <% end %>
      </dhcp>
    <% end %>
    </ip>
  <% end %>

  <% if !@network_ipv6_address.nil? && !@network_ipv6_prefix.nil? %>
    <ip family='ipv6' address="<%= @network_ipv6_address %>" prefix="<%= @network_ipv6_prefix %>"></ip>
  <% end %>

</network>
